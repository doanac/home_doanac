# increase the defaults for history
HISTSIZE=3000
HISTFILESIZE=4000

alias storage="ssh -XC 192.168.0.120"
alias reckless="ssh -A -XC reckless"

export EDITOR=vim

eval $(systemctl --user show-environment | grep SSH_AUTH_SOCK)
export SSH_AUTH_SOCK

#aliases for using a single gvim instance
function gvim-s ()
{
	if [ $# -eq 0 ] ; then
		gvim
	else
		gvim --remote-tab-silent $*
	fi
}
alias gvim="gvim-s"
#aliases for using a single console instance
function vim-s ()
{
	if [ $# -eq 0 ] ; then
		vim --servername DOANAC-LAP
	else
		vim --servername DOANAC-LAP --remote-tab-silent $*
	fi
}

alias ssh-forget="ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no"

alias vi=vim

# k8s stuff
function first_pod ()
{
	kubectl --context $1 --namespace $2 get pods  | grep $3 | head -n1 | cut -d\  -f1
}
function jobserv-shell ()
{
	pod=$(first_pod $1 jobserv jobserv)
	echo == conecting to $pod ...
	kubectl --context $1 --namespace jobserv exec -it $pod /bin/sh
}
alias jobserv-og="jobserv-shell gke_osf-prod_us-central1-a_osf-prod"

function lmp-api-shell ()
{
	pod=$(first_pod gke_osf-prod_us-central1-a_osf-prod mgmt ota-api)
	echo == conecting to $pod ...
	kubectl --context gke_osf-prod_us-central1-a_osf-prod --namespace mgmt exec -it $pod /bin/sh
}

function k8s-tail ()
{
	pod=$(kubectl --context $1 --namespace $2 get pods  | grep $3 | head -n1 | cut -d\  -f1)
	echo == conecting to $pod ...
	kubectl --context $1 --namespace $2 logs --tail 1000 -f $pod
}

function k8s-shell ()
{
	pod=$(first_pod gke_osf-prod_us-central1-a_osf-prod $1 $2)
	echo == conecting to $pod ...
	kubectl --context gke_osf-prod_us-central1-a_osf-prod --namespace $1 exec -it $pod /bin/sh
}

alias jobserv-tail-gitpoller='k8s-tail gke_osf-prod_us-central1-a_osf-prod jobserv git-poller'
alias jobserv-tail-lavareaper='k8s-tail gke_osf-prod_us-central1-a_osf-prod jobserv lava-reaper'
alias jobserv-tail-workermonitor='k8s-tail gke_osf-prod_us-central1-a_osf-prod jobserv worker'
alias analyticz-tail='k8s-tail gke_osf-prod_us-central1-a_osf-prod data analyticz'

alias jobserv-curl="curl -H \"OSF-TOKEN: $(cat $HOME/.osf-token)\" $*"

function docker_clean_images(){
	docker rm -v $(docker ps --filter status=exited -q 2>/dev/null) 2>/dev/null
	docker rmi $(docker images --filter dangling=true -q 2>/dev/null) 2>/dev/null
}
